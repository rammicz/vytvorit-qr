# Vývojářská pravidla - Vytvořte QR kód

## 🚀 Před každým pushnutím

### Lokální testování
- VŽDY spustit `npm run build` před pushnutím
- Pokud máš Docker Desktop: `docker build -t vytvorit-qr-local .`
- Všechny TypeScript chyby MUSÍ být opraveny před pushnutím

### TypeScript kontrola
- Používat `tsc --noEmit` pro rychlou kontrolu bez buildu
- Nepoužívané proměnné/funkce/props MUSÍ být odstraněny
- Všechny `any` typy musí být nahrazeny konkrétními typy

## 🐳 Docker & Cloud Run pravidla

### Port konfigurace
- Cloud Run vždy používá `PORT` environment variable (výchozí 8080)
- Nginx musí naslouchat na dynamickém portu, ne na pevném 80
- Používat startup script pro nahrazení portu v runtime

### Dependencies
- Build stage MUSÍ instalovat VŠECHNY dependencies (včetně devDependencies)
- Používat `npm ci` místo `npm ci --only=production` pro build
- DevDependencies se odstraní automaticky v multi-stage build

### Region optimalizace
- Pro ČR používat `europe-central2` (Warsaw) - nejlepší latence
- Alternativně `europe-west3` (Frankfurt) - také dobré pro ČR
- NE `europe-west1` (Belgium) - příliš daleko

## 📝 Commit pravidla

### Commit messages
```
fix: popis opravy
feat: popis nové funkce
docs: změny v dokumentaci
style: formátování, bez změn logiky
refactor: refaktoring kódu
```

### Atomic commits
- Jeden commit = jedna logická změna
- Necommituj nefunkční kód
- Testovat před každým commitem

## 🔧 Troubleshooting checklist

### Build selhává?
- [ ] `npm run build` funguje lokálně?
- [ ] Všechny TypeScript chyby opraveny?
- [ ] DevDependencies nainstalovány v Dockerfile?
- [ ] Port správně nakonfigurován pro Cloud Run?

### Cloud Run deployment selhává?
- [ ] Container naslouchá na `PORT` environment variable?
- [ ] Startup script má správná oprávnění (`chmod +x`)?
- [ ] Nginx konfigurace používá dynamický port?
- [ ] Cloud Run service má správný port nastavený?

### Performance problémy?
- [ ] Správný region pro cílovou lokalitu?
- [ ] Bundle size pod kontrolou (< 250 kB gzip)?
- [ ] Gzip komprese zapnutá?
- [ ] Cache headers správně nastavené?

## 🎯 Quick fixes

### TypeScript chyby
```bash
# Rychlá kontrola
npx tsc --noEmit

# Oprava automatických chyb
npx tsc --noEmit --fix
```

### Docker build
```bash
# Lokální test
docker build -t test .

# Spuštění kontejneru
docker run -p 8080:8080 -e PORT=8080 test
```

### Cloud Run debug
```bash
# Logy služby
gcloud run services logs vytvorit-qr --region=europe-central2

# Popis služby
gcloud run services describe vytvorit-qr --region=europe-central2
```

## 📋 Pre-deployment checklist

- [ ] `npm run build` prošel bez chyb
- [ ] Všechny TypeScript chyby opraveny
- [ ] Docker build funguje lokálně (pokud je Docker dostupný)
- [ ] Commit message je popisný
- [ ] Změny jsou atomic a funkční
- [ ] Region je optimalizovaný pro cílovou lokalitu

## 🚨 Časté chyby a řešení

### "tsc: not found"
- **Příčina**: `npm ci --only=production` neinstaluje devDependencies
- **Řešení**: Použít `npm ci` v Dockerfile

### "Container failed to start and listen on port"
- **Příčina**: Nginx naslouchá na pevném portu 80 místo `$PORT`
- **Řešení**: Použít startup script pro dynamický port

### "Type error: Property does not exist"
- **Příčina**: Nepoužívané props v komponentách
- **Řešení**: Odstranit nepoužívané props nebo je správně typovat

---

**Zapamatuj si:** Vždy testuj lokálně před pushnutím! 🚀
